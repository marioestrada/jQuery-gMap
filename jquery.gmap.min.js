/**
 * jQuery gMap - Google Maps API V3
 *
 * @url 	http://github.com/marioestrada/jQuery-gMap
 * @author	Mario Estrada <me@mario.ec> based on original plugin by Cedric Kastner <cedric@nur-text.de>; modified to add custom styles by Jonathan Moldofsky <jm@jgrant.us>
 * @version	2.1.4
 */
 (function(e){e.fn.gMap=function(t,n){switch(t){case"addMarker":return e(this).trigger("gMap.addMarker",[n.latitude,n.longitude,n.content,n.icon,n.popup]);case"centerAt":return e(this).trigger("gMap.centerAt",[n.latitude,n.longitude,n.zoom]);case"clearMarkers":return e(this).trigger("gMap.clearMarkers")}var r=e.extend({},e.fn.gMap.defaults,t);return this.each(function(){var t=new google.maps.Map(this);var n=new google.maps.Geocoder;if(r.address){n.geocode({address:r.address},function(e,n){if(e&&e.length)t.setCenter(e[0].geometry.location)})}else{if(r.latitude&&r.longitude){t.setCenter(new google.maps.LatLng(r.latitude,r.longitude))}else{if(e.isArray(r.markers)&&r.markers.length>0){if(r.markers[0].address){n.geocode({address:r.markers[0].address},function(e,n){if(e&&e.length>0)t.setCenter(e[0].geometry.location)})}else{t.setCenter(new google.maps.LatLng(r.markers[0].latitude,r.markers[0].longitude))}}else{t.setCenter(new google.maps.LatLng(34.885931,9.84375))}}}t.setZoom(r.zoom);var i={scrollwheel:r.scrollwheel,disableDoubleClickZoom:!r.doubleclickzoom};if(r.controls===false){e.extend(i,{disableDefaultUI:true})}else if(r.controls.length!=0){e.extend(i,r.controls,{disableDefaultUI:true})}if(r.useCustomStyle===false){t.setMapTypeId(google.maps.MapTypeId[r.maptype])}else{var s=r.styleList;var o=new google.maps.StyledMapType(s,{name:"Styled Map"});e.extend(i,{mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId[r.maptype],"map_style"]}});t.setOptions(i);t.mapTypes.set("map_style",o);t.setMapTypeId("map_style")}var u=new google.maps.Marker;marker_icon=new google.maps.MarkerImage(r.icon.image);marker_icon.size=new google.maps.Size(r.icon.iconsize[0],r.icon.iconsize[1]);marker_icon.anchor=new google.maps.Point(r.icon.iconanchor[0],r.icon.iconanchor[1]);u.setIcon(marker_icon);if(r.icon.shadow){marker_shadow=new google.maps.MarkerImage(r.icon.shadow);marker_shadow.size=new google.maps.Size(r.icon.shadowsize[0],r.icon.shadowsize[1]);marker_shadow.anchor=new google.maps.Point(r.icon.shadowanchor[0],r.icon.shadowanchor[1]);u.setShadow(marker_shadow)}e(this).bind("gMap.centerAt",function(e,n,r,i){if(i)t.setZoom(i);t.panTo(new google.maps.LatLng(parseFloat(n),parseFloat(r)))});var a=[];e(this).bind("gMap.clearMarkers",function(){while(a[0]){a.pop().setMap(null)}});var f;e(this).bind("gMap.addMarker",function(e,n,i,s,o,l){var c=new google.maps.LatLng(parseFloat(n),parseFloat(i));var h=new google.maps.Marker({position:c});if(o){marker_icon=new google.maps.MarkerImage(o.image);marker_icon.size=new google.maps.Size(o.iconsize[0],o.iconsize[1]);marker_icon.anchor=new google.maps.Point(o.iconanchor[0],o.iconanchor[1]);h.setIcon(marker_icon);if(o.shadow){marker_shadow=new google.maps.MarkerImage(o.shadow);marker_shadow.size=new google.maps.Size(o.shadowsize[0],o.shadowsize[1]);marker_shadow.anchor=new google.maps.Point(o.shadowanchor[0],o.shadowanchor[1]);u.setShadow(marker_shadow)}}else{h.setIcon(u.getIcon());h.setShadow(u.getShadow())}if(s){if(s=="_latlng")s=n+", "+i;var p=new google.maps.InfoWindow({content:r.html_prepend+s+r.html_append});google.maps.event.addListener(h,"click",function(){f&&f.close();p.open(t,h);f=p});if(l){google.maps.event.addListenerOnce(t,"tilesloaded",function(){p.open(t,h)})}}h.setMap(t);a.push(h)});for(var l=0;l<r.markers.length;l++){marker=r.markers[l];if(marker.address){if(marker.html=="_address")marker.html=marker.address;var c=this;n.geocode({address:marker.address},function(t,n){return function(r,i){if(r&&r.length>0){e(n).trigger("gMap.addMarker",[r[0].geometry.location.lat(),r[0].geometry.location.lng(),t.html,t.icon,t.popup])}}}(marker,c))}else{e(this).trigger("gMap.addMarker",[marker.latitude,marker.longitude,marker.html,marker.icon,marker.popup])}}})};e.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:false,doubleclickzoom:true,maptype:"ROADMAP",useCustomStyle:false,styleList:[{featureType:"water",stylers:[{hue:"#00ffff"}]}],html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}})(jQuery)
